<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Exhibition Floorplan</title>
<style>
  body{font-family:Arial,Helvetica,sans-serif;margin:0;padding:16px;background:#fff;color:#111;}
  h1{margin:0 0 10px 0;}
  .muted{color:#666;font-size:13px;}
  table{width:100%;border-collapse:collapse;margin-top:12px;font-size:14px;}
  th,td{border-bottom:1px solid #eee;padding:8px;text-align:left;}
  .sold{color:#a11414;font-weight:700;}
  .avail{color:#0f6a2f;font-weight:700;}
</style>
</head>
<body>
<h1 id="eventName">Loadingâ€¦</h1>
<div class="muted" id="updated"></div>

<table>
  <thead><tr><th>Stand</th><th>Status</th><th>Company</th></tr></thead>
  <tbody id="tbody"></tbody>
</table>

<script>
(function(){
  const API_BASE = "https://floorplansaberdeen.floorplansaberdeen.workers.dev";

  async function fetchJson(url){
    const res = await fetch(url, {cache:"no-store"});
    const text = await res.text();
    let json=null; try{json=JSON.parse(text);}catch{throw new Error("Non-JSON response");}
    if (!res.ok || (json && json.ok===false)) throw new Error((json&&json.error) ? json.error : ("HTTP "+res.status));
    return json;
  }

  async function load(){
    try{
      const settings = await fetchJson(API_BASE + "/settings?ts=" + Date.now());
      document.getElementById("eventName").textContent = settings.eventName || "New Event";

      const stands = await fetchJson(API_BASE + "/stands?ts=" + Date.now());
      const tbody = document.getElementById("tbody");
      tbody.innerHTML = "";

      (Array.isArray(stands) ? stands : []).forEach(s=>{
        const tr=document.createElement("tr");
        const sold = String(s.status||"").toLowerCase()==="sold";
        tr.innerHTML =
          "<td>"+(s.standId||"")+"</td>" +
          "<td class='"+(sold?"sold":"avail")+"'>"+(sold?"Sold":"Available")+"</td>" +
          "<td>"+(sold ? (s.company||"") : "")+"</td>";
        tbody.appendChild(tr);
      });

      document.getElementById("updated").textContent = "Updated: " + new Date().toLocaleTimeString();
    }catch(e){
      document.getElementById("eventName").textContent = "Load error";
      document.getElementById("updated").textContent = e.message;
      console.error(e);
    }
  }

  load();
  setInterval(load, 15000);
})();
</script>
</body>
</html>
